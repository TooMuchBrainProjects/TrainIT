@page "/allexercises"
@page "/allexercises/{PresetId:int?}"
@using Model.Entities
@using Domain.Repositories.Interfaces
@using WebGui.Services
@inject UserService UserService;
@inject ISubExerciseRepository SubExerciseRepository;
@inject IRepository<Preset> PresetRepository;
@inject IRepository<Exercise> ExerciseRepository;

<AuthorizeView>
    <Authorized>
        <MudContainer Class="mt-8">
            <MudStack Spacing="16">
                @if (Preset == null)
                {
                    <h1 class="ms-4">All Exercises</h1>
                }
                else
                {
                    <h1 class="ms-4">@Preset.Name</h1>
                }

                <MudDivider/>
            </MudStack>

            <DataInit Data="Exercises">
                <ChildContent Context="exercises">
                    <MudList Clickable="false">
                        @foreach (var exercise in exercises)
                        {
                            <MudListItem>
                                <MudCheckBox Color="Color.Primary" Value="@exercise.Name" @bind-Checked="@exercise.IsSelected"></MudCheckBox>
                            </MudListItem>
                        }
                    </MudList>
                </ChildContent>
            </DataInit>
        </MudContainer>

        <div Style="position: fixed; bottom: 9vh; right: 2vh;">
            <MudFab Color="Color.Tertiary" StartIcon="@Icons.Material.Filled.Check" OnClick="AddSubExercises"/>
        </div>
    </Authorized>
    <NotAuthorized>

    </NotAuthorized>
</AuthorizeView>


@code {

    [Parameter]
    public int? PresetId { get; set; }

    public Preset Preset { get; set; }

    public List<Exercise> Exercises { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (PresetId != null)
        {
            Preset = await PresetRepository.ReadAsync(PresetId.Value);
    // Exercises = await ExerciseRepository.ReadAsync(e => e.)
        }
        else
        {
            Exercises = await ExerciseRepository.ReadAsync(e => e.UserId == UserService.CurrentUser.Id);
        }
    }

    public void AddSubExercises()
    {
    // Exercises = Exercises.Where(e => e.IsSelected == true).ToList();
    }

}